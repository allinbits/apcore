
# Setup, Start, End, and Clean-up Dither Server

## Setup

### 1. Start colima

colima start

### 2. Create a docker volume to store the database

docker volume create apcore-pgdata

### 3. Initialize the DB

Run the make command to bring up the postgres container.
If it does not already exist, it will create a `data` 
directory in this repo that is ignored by git.

```shell
make up
```

### 4. Create a openssl key for apcore

Now it is time to generate openssl certs using another make command. These are stored in `data/certs`

```shell
make certs
```

### 5. Create config.ini file for example

If a config.ini does not already exist run the make command to generate a config.ini in `data/config`

```shell
make config.ini
```

Important configuration options:
cert file: /data/certs/cert.pem
key file: /data/certs/key.pem
cookie auth key file: /data/config/cookie_authn.key


### values generated by the postgres database

pg_user apcore
pg_host localhost
pg_port 5432
password secret
pg_db_name apcoredb
pg_ssl_mode disable
pg_schema public

### 6. initialize db based on config.ini

Next it is important initialize the DB. Run the make command
to initialize this database

```shell
make init-db
```

### 7. initialize admin account based on config.ini

```shell
make init-admin
```

## Start Server

### 1. Start colima (which has the docker container in it)

colima start

### 2. Start the docker container `apcore-postgres` inside of colima

docker start apcore-postgres

### 3. Start the server! (called example)

example serve

# Stop Server

## 1. Stop docker container and check it's turned off

docker stop apcore-postgres
docker ps
docker ps -a # show even stopped containers

## 2. Stop colima and check it's turned off

colima stop
colima status

# Clean-up Dither server

## 1. Stop and delete the container

docker stop apcore-postgres
docker rm apcore-postgres

## 2. Delete the Docker volume

docker volume rm apcore-pgdata

## 3. Remove certs

rm -rf ~/.apcore/certs
