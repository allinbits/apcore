
# Setup, Start, End, and Clean-up Dither Server

## Setup

### 1. Start colima

colima start

### 2. Create a docker volume to store the database

docker volume create apcore-pgdata

### 3. Create a docker container called apcore-postgres

docker run --name apcore-postgres \
  -e POSTGRES_USER=apcore \
  -e POSTGRES_PASSWORD=secret \
  -e POSTGRES_DB=apcoredb \
  -p 5432:5432 \
  -v apcore-pgdata:/var/lib/postgresql/data \
  -d postgres:15

### 4. Create a openssl key for apcore

mkdir -p ~/.apcore/certs

openssl req -x509 -newkey rsa:4096 \
  -keyout ~/.apcore/certs/key.pem \
  -out ~/.apcore/certs/cert.pem \
  -days 365 -nodes \
  -subj "/CN=localhost"

### 5. Create config.ini file for example

example configure

### values generated by the postgres database

pg_user apcore
pg_host localhost
pg_port 5432
password secret
pg_db_name apcoredb
pg_ssl_mode disable
pg_schema public

### 6. initialize db based on config.ini

example init-db

### 7. initialize admin account based on config.ini

example init-admin

## Start Server

### 1. Start colima (which has the docker container in it)

colima start

### 2. Start the docker container `apcore-postgres` inside of colima

docker start apcore-postgres

### 3. Start the server! (called example)

example serve

# Stop Server

## 1. Stop docker container and check it's turned off

docker stop apcore-postgres
docker ps
docker ps -a # show even stopped containers

## 2. Stop colima and check it's turned off

colima stop
colima status

# Clean-up Dither server

## 1. Stop and delete the container

docker stop apcore-postgres
docker rm apcore-postgres

## 2. Delete the Docker volume

docker volume rm apcore-pgdata

## 3. Remove certs

rm -rf ~/.apcore/certs
